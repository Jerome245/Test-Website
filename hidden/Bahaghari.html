<!DOCTYPE html>
<html>
	<head>
		<title id='titlee'></title>
		<meta charset='utf-8'>
		<meta name='viewport' content='width=device-width, initial-scale=1'>
		<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css'>
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js'></script>
		<script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js'></script>
	</head>
	<script>
		var club = 'Bahaghari';
		var start = 0;
		
		function turnToAccepted(email, ID){
			
			var ID1 = ID + 'First';
			var ID2 = ID + 'Second';
			
			var element = document.getElementById(ID1);
			element.parentNode.removeChild(element);
			
			element = document.getElementById(ID2);
			element.parentNode.removeChild(element);

			$.ajax({
				url : 'accept',
				type: 'POST',
				data : {email: email, club: club},
				success: function(data){
					loadTable();
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
					loadTable();
				} ,
			});
		}
		
		function turnToRejected(email, ID){
		
			var ID1 = ID + 'First';
			var ID2 = ID + 'Second';
			
			var element = document.getElementById(ID1);
			element.parentNode.removeChild(element);
			
			element = document.getElementById(ID2);
			element.parentNode.removeChild(element);
			
			$.ajax({
				url : 'reject',
				type : 'POST',
				data : {email: email, club: club},
				success: function(data){
					loadTable();
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
					loadTable();
				} ,
			});
		}
		function startUp(){
		    document.getElementById('titlee').innerHTML = club;
			document.getElementById('titleee').innerHTML = club;
		    loadTable();
		    loadLogs();
		}
		function loadTable(){
			$.ajax({
				url : 'displaytable',
				type : 'POST',
				data : {club: club, status: 'Accepted', priority: 'First'},
				success : function(data) {
					if (data != 'Error') {
						data = JSON.parse(data);
						var output = '<tr><th>Name</th><th>Section</th><th>Mobile No.</th><th>Email</th></tr>';
						for (var q = 0; q != data.length; q++) {   
							output+='<tr>';
							for (var i = 0; i != 4; i++) {   				
								output+='<td>' + data[q][i] + '</td>';
							}
							output+='</tr>';
						}
						document.getElementById('displaytableFirst').innerHTML = output;
					}
					else {
					    document.getElementById('displaytableFirst').innerHTML = '';
					}
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
				} ,
				timeout: 5000
			});
			$.ajax({
				url : 'displaytable',
				type : 'POST',
				data : {club: club, status: 'Accepted', priority: 'Second'},
				success : function(data) {
					if (data != 'Error'){
						var output = '<tr><th>Name</th><th>Section</th><th>Mobile No.</th><th>Email</th></tr>';
						for (var q = 0; q != data.length; q++) {   
							output+='<tr>';
							for (var i = 0; i != 4; i++) {   				
								output+='<td>' + data[q][i] + '</td>';
							}
							output+='</tr>';
						}
						document.getElementById('displaytableSecond').innerHTML = output;
					}
					else {
					    document.getElementById('displaytableFirst').innerHTML = '';
					}
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
				} ,
				timeout: 5000
			});
			$.ajax({
				url : 'displaytable',
				type : 'POST',
				data : {club: club, status: 'Limbo', priority: 'First'},
				success : function(data) {
					if (data == 'Error'){
						document.getElementById('displaytableLimbo').innerHTML = '';
					}
					else{
						data = JSON.parse(data);
						var num = 0;
						var output = '<tr><th>Name</th><th>Section</th><th>Mobile No.</th><th>Email</th><th>Priority</th><th>Button</th></tr>';
						for (var q = 0; q != data.length; q++) {   
							output+='<tr>';
							num = num + 1;
							for (var i = 0; i != 5; i++) {   				
								output+='<td>' + data[q][i] + '</td>';
							}
							var email =  data[q][3];
							output += "<td><button id='" + num + "First" + "' class='btn' onclick=turnToAccepted('" + email + "','" + num + "')>Accept</button>";
							output += "<button id='" + num + "Second" + "' class='btn' onclick=turnToRejected('" + email + "','" + num + "')>Reject</button></td>";
							output+='</tr>';
						}
						document.getElementById('displaytableLimbo').innerHTML = output;
					}
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
				} ,
				timeout: 5000
			});
		}
		function loadLogs(){
			if (start == 0){
		        Email = 'None';
		        Type = 'None';
		        start += 1;
		    }
		    else{
		        Email = document.getElementById('email').value;
		        Type = document.getElementById('type').value;
		    }
		    $.ajax({
				url : 'getdropdown',
				type : 'POST',
				data : {entree: 'Email', club: club},
				success : function(data) {
				    var output = '<option>None</option>';
					if (data != 'Error') {
						data = JSON.parse(data);
						output = '<option>None</option>';
						for (var q = 1; q != data.length; q++) {   
							output += '<option>' + data[q][0] + '</option>';
						}
						document.getElementById('email').innerHTML = output;
						document.getElementById('email').value = Email;
					}
					else{
					    document.getElementById('email').innerHTML = output;
					    document.getElementById('email').value = 'None';
					}
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
					document.getElementById('email').value = 'None';
				} ,
				timeout: 5000
			});
			$.ajax({
				url : 'getdropdown',
				type : 'POST',
				data : {entree: 'Type', club: club},
				success : function(data) {
				    var output = '<option>None</option>';
					if (data != 'Error') {
						data = JSON.parse(data);
						output = '<option>None</option>';
						for (var q = 1; q != data.length; q++) {   
							output += '<option>' + data[q][0] + '</option>';
						}
						document.getElementById('type').innerHTML = output;
						document.getElementById('type').value = Type;
					}
					else{
					    document.getElementById('type').innerHTML = output;
					    document.getElementById('type').value = 'None';
					}
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
					document.getElementById('type').value = 'None';
				} ,
				timeout: 5000
			});
			$.ajax({
				url : 'displayalert',
				type : 'POST',
				data : {Email:Email, Type:Type, Club:club},
				success : function(data) {
					if (data != 'Empty') {
					    data = JSON.parse(data);
    					var output = '<tr><th>Alert</th><th>Time</th>';
    					for (var q = 0; q != data.length; q++) {   
    						output+='<tr>';
    						for (var i = 0; i != 2; i++) {   				
    							output+='<td>' + data[q][i] + '</td>';
    						}
    						output+='</tr>';
    					}
    					document.getElementById('displaytable').innerHTML = output;
					}
					else {
					    document.getElementById('displaytable').innerHTML = 'Empty';
					}
				},
				error : function(request,error){
					console.log('Request: '+ error + '\n' + request);
				} ,
				timeout: 5000
			});
		}
	</script>
	<body onload='startUp()'>
		 <nav class='navbar navbar-expand-md bg-dark navbar-dark' id='navv'>
			<a class='navbar-brand' href='#'>
				<img src='PSHS-CLC_logo.png' alt='Logo' style='width:40px;'>
				PSHS-CLC Clubs
			</a>

			<button class='navbar-toggler' type='button' data-toggle='collapse' data-target='#collapsibleNavbar'>
				<span class='navbar-toggler-icon'></span>
			</button>

			<div class='collapse navbar-collapse' id='collapsibleNavbar'>
				<ul class='navbar-nav'>
					<li class='nav-item'>
						<h4 style='color:white' id='titleee'></h4>
					</li>
				</ul>
			</div>
		</nav>
		<br>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<h3>First Choice:</h3>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<table id='displaytableFirst' class='table table-striped'></table>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<h3>Second Choice:</h3>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<table id='displaytableSecond' class='table table-striped'></table>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<h3>Limbo:</h3>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<table id='displaytableLimbo' class='table table-striped'></table>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<button class='btn' type='button' onclick='loadTable()'>Reload Table</button>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<h3>Logs</h3>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
				    <label for='email'>Email:</label>
				    <select id='email'></select>
				    <label for='type'>Type:</label>
				    <select id='type'></select>
					<button class='btn' type='button' onclick='loadLogs()'>Load Logs</button>
				</div>
			</div>
			<div class='row justify-content-center'>
				<div class='col-sm-10 '>
					<table id='displaytable' class='table table-striped'></table>
				</div>
			</div>
	</body>
</html>